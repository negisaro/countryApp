import{I as u,fa as h,g as a,h as l,i,k as c,na as b,o as p,oa as g,s as m}from"./chunk-4D4JGOBX.js";var f={baseUrl:"http://localhost:8080"};var d=class o{baseUrl=f.baseUrl;http=m(g);_currentUser=u(null);_authStatus=u("checking");currentUser=h(()=>this._currentUser());authStatus=h(()=>this._authStatus());constructor(){this.checkAuthStatus().subscribe()}setAuthentication(e,t){return this._currentUser.set(e),this._authStatus.set("authenticated"),localStorage.setItem("token",t),!0}login(e,t){let n=`${this.baseUrl}/login`,s={username:e,password:t};return this.http.post(n,s).pipe(i(({user:r,token:k})=>this.setAuthentication(r,k)),c(r=>l(()=>r.error.message)))}checkAuthStatus(){let e=`${this.baseUrl}/login`,t=localStorage.getItem("token");if(!t)return this.logout(),a(!1);let n=new b().set("Authorization",`Bearer ${t}`);return this.http.get(e,{headers:n}).pipe(i(({user:s,token:r})=>this.setAuthentication(s,r)),c(()=>(this._authStatus.set("notAuthenticated"),a(!1))))}logout(){localStorage.removeItem("token"),this._currentUser.set(null),this._authStatus.set("notAuthenticated")}static \u0275fac=function(t){return new(t||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{d as a};
